<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>普通索引和唯一索引 | LWG Study</title>
    <meta name="description" content="A VitePress Site">
    <meta name="generator" content="VitePress v1.2.2">
    <link rel="preload stylesheet" href="/assets/style.ru6fHfS6.css" as="style">
    
    <script type="module" src="/assets/app.BhxXKgYK.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.C70_P7hw.js">
    <link rel="modulepreload" href="/assets/chunks/theme.BpEB4cZC.js">
    <link rel="modulepreload" href="/assets/DATABASE_MySQL_chap08.md.sjugScbW.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-bf403e95><!--[--><!--]--><!--[--><span tabindex="-1" data-v-1c5a89bd></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-1c5a89bd> Skip to content </a><!--]--><!----><header class="VPNav" data-v-bf403e95 data-v-5d51f9b9><div class="VPNavBar has-sidebar top" data-v-5d51f9b9 data-v-46bc1d00><div class="wrapper" data-v-46bc1d00><div class="container" data-v-46bc1d00><div class="title" data-v-46bc1d00><div class="VPNavBarTitle has-sidebar" data-v-46bc1d00 data-v-4bb1af6f><a class="title" href="/" data-v-4bb1af6f><!--[--><!--]--><!----><span data-v-4bb1af6f>LWG Study</span><!--[--><!--]--></a></div></div><div class="content" data-v-46bc1d00><div class="content-body" data-v-46bc1d00><!--[--><!--]--><div class="VPNavBarSearch search" data-v-46bc1d00><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-46bc1d00 data-v-b71c1798><span id="main-nav-aria-label" class="visually-hidden" data-v-b71c1798>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/SpringBoot/chapter1.html" tabindex="0" data-v-b71c1798 data-v-5a301c13><!--[--><span data-v-5a301c13>SpringBoot</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/DATABASE/MySQL/chap00.html" tabindex="0" data-v-b71c1798 data-v-5a301c13><!--[--><span data-v-5a301c13>DATABASE</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/JAVA/%E5%9F%BA%E7%A1%80/chapter1.html" tabindex="0" data-v-b71c1798 data-v-5a301c13><!--[--><span data-v-5a301c13>JAVA</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-46bc1d00 data-v-583f7be7><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-583f7be7 data-v-366ae653 data-v-46fdce64><span class="check" data-v-46fdce64><span class="icon" data-v-46fdce64><!--[--><span class="vpi-sun sun" data-v-366ae653></span><span class="vpi-moon moon" data-v-366ae653></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-46bc1d00 data-v-c1ddac85 data-v-1c05cfa7><!--[--><a class="VPSocialLink no-icon" href="https://gitee.com/gasj0ee/java_No1_knowledge/tree/master/" aria-label="github" target="_blank" rel="noopener" data-v-1c05cfa7 data-v-f4be3c87><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-46bc1d00 data-v-16ac573a data-v-f7c62dd4><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-f7c62dd4><span class="vpi-more-horizontal icon" data-v-f7c62dd4></span></button><div class="menu" data-v-f7c62dd4><div class="VPMenu" data-v-f7c62dd4 data-v-309b610c><!----><!--[--><!--[--><!----><div class="group" data-v-16ac573a><div class="item appearance" data-v-16ac573a><p class="label" data-v-16ac573a>Appearance</p><div class="appearance-action" data-v-16ac573a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-16ac573a data-v-366ae653 data-v-46fdce64><span class="check" data-v-46fdce64><span class="icon" data-v-46fdce64><!--[--><span class="vpi-sun sun" data-v-366ae653></span><span class="vpi-moon moon" data-v-366ae653></span><!--]--></span></span></button></div></div></div><div class="group" data-v-16ac573a><div class="item social-links" data-v-16ac573a><div class="VPSocialLinks social-links-list" data-v-16ac573a data-v-1c05cfa7><!--[--><a class="VPSocialLink no-icon" href="https://gitee.com/gasj0ee/java_No1_knowledge/tree/master/" aria-label="github" target="_blank" rel="noopener" data-v-1c05cfa7 data-v-f4be3c87><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-46bc1d00 data-v-04513a86><span class="container" data-v-04513a86><span class="top" data-v-04513a86></span><span class="middle" data-v-04513a86></span><span class="bottom" data-v-04513a86></span></span></button></div></div></div></div><div class="divider" data-v-46bc1d00><div class="divider-line" data-v-46bc1d00></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-bf403e95 data-v-206e55a3><div class="container" data-v-206e55a3><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-206e55a3><span class="vpi-align-left menu-icon" data-v-206e55a3></span><span class="menu-text" data-v-206e55a3>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-206e55a3 data-v-501b643f><button data-v-501b643f>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-bf403e95 data-v-98e42a8e><div class="curtain" data-v-98e42a8e></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-98e42a8e><span class="visually-hidden" id="sidebar-aria-label" data-v-98e42a8e> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-98e42a8e><section class="VPSidebarItem level-0 collapsible has-active" data-v-98e42a8e data-v-e16b36d7><div class="item" role="button" tabindex="0" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><h2 class="text" data-v-e16b36d7>MySQL</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e16b36d7><span class="vpi-chevron-right caret-icon" data-v-e16b36d7></span></div></div><div class="items" data-v-e16b36d7><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap00.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>MySQL 底层数据结构：B+树</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap01.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>MySQL基础架构</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap02.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>MySQL日志系统</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap03.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>事务隔离</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap04.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>索引</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap05.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>全局锁和表锁</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap06.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>行锁</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap07.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>事务是否需要隔离</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap08.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>普通索引和唯一索引</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap09.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>MySQL为什么会选错索引？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap10.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>如何给字符串加索引？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap11.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>为什么 MySQL 会“抖”一下</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap12.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>MySQL数据库表的空间回收</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap13.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>count(\*)语句</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap14.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>日志和索引相关问题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap15.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>order by 是如何工作的</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap16.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>如何正确显示随机消息</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap17.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>为什么 SQL 语句逻辑相同，但性能却差异巨大？</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e16b36d7 data-v-e16b36d7><div class="item" data-v-e16b36d7><div class="indicator" data-v-e16b36d7></div><a class="VPLink link link" href="/DATABASE/MySQL/chap18.html" data-v-e16b36d7><!--[--><p class="text" data-v-e16b36d7>为什么查询一行的语句，执行也会很慢</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-bf403e95 data-v-b3d11645><div class="VPDoc has-sidebar has-aside" data-v-b3d11645 data-v-95d215ae><!--[--><!--]--><div class="container" data-v-95d215ae><div class="aside" data-v-95d215ae><div class="aside-curtain" data-v-95d215ae></div><div class="aside-container" data-v-95d215ae><div class="aside-content" data-v-95d215ae><div class="VPDocAside" data-v-95d215ae data-v-0148090c><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-0148090c data-v-92f2a883><div class="content" data-v-92f2a883><div class="outline-marker" data-v-92f2a883></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-92f2a883>On this page</div><ul class="VPDocOutlineItem root" data-v-92f2a883 data-v-2afd1398><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-0148090c></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-95d215ae><div class="content-container" data-v-95d215ae><!--[--><!--]--><main class="main" data-v-95d215ae><div style="position:relative;" class="vp-doc _DATABASE_MySQL_chap08" data-v-95d215ae><div><h1 id="普通索引和唯一索引" tabindex="-1">普通索引和唯一索引 <a class="header-anchor" href="#普通索引和唯一索引" aria-label="Permalink to &quot;普通索引和唯一索引&quot;">​</a></h1><p>举例说明：假设字段k上的值都不重复。InnoDB的索引组织结构如下所示：</p><p><img src="/assets/1.B9EzMG0Z.png" alt="image"></p><p>以下主要从性能的角度来考虑采用唯一索引还是普通索引？（查询语句和更新语句）</p><h2 id="查询过程" tabindex="-1">查询过程 <a class="header-anchor" href="#查询过程" aria-label="Permalink to &quot;查询过程&quot;">​</a></h2><p>假设，执行查询的语句是 select id from T where k=5；这个查询语句在索引树上查找的过程，先是通过 B+ 树从树根开始，按层搜索到叶子节点，也就是图中右下角的这个数据页，然后可以认为数据页内部通过二分法来定位记录。</p><ul><li>对于普通索引来说，查找到满足条件的第一个记录 (5,500) 后，<strong>需要查找下一个记录，直到碰到第一个不满足 k=5 条件的记录</strong>。</li><li>对于唯一索引来说，由于索引定义了唯一性，<strong>查找到第一个满足条件的记录后，就会停止继续检索</strong>。</li></ul><p>这两种索引方式在查询过程中性能差距微乎其微，原因是：</p><ul><li>InnoDB 的数据是按数据页为单位来读写的，当找到 k=5 的记录的时候，它所在的数据页就都在内存里了。</li><li>对于普通索引来说，要多做的那一次“查找和判断下一条记录”的操作，就只需要一次指针寻找和一次计算。</li></ul><h2 id="更新过程" tabindex="-1">更新过程 <a class="header-anchor" href="#更新过程" aria-label="Permalink to &quot;更新过程&quot;">​</a></h2><h3 id="change-buffer" tabindex="-1">change buffer <a class="header-anchor" href="#change-buffer" aria-label="Permalink to &quot;change buffer&quot;">​</a></h3><ul><li>当需要更新一个数据页时，如果数据页在内存中就直接更新，而如果这个数据页还没有在内存中的话，在不影响数据一致性的前提下，InnoDB 会<strong>将这些更新操作缓存在 change buffer 中</strong>，这样就不需要从磁盘中读入这个数据页了</li><li>在下次查询需要访问这个数据页的时候，将数据页读入内存，然后执行 change buffer 中与这个页有关的操作</li><li>change buffer是可以持久化的数据，即change buffer 在内存中有拷贝，也会被写入到磁盘上</li><li><strong>将 change buffer 中的操作应用到原数据页</strong>，得到最新结果的过程称为 merge</li><li>除了访问这个数据页会触发 merge 外，系统有后台线程会定期 merge。在数据库正常关闭（shutdown）的过程中，也会执行 merge 操作。</li></ul><p>change buffer的<strong>使用条件</strong>：</p><ul><li>唯一索引的更新就不能使用 change buffer，实际上也只有普通索引可以使用</li><li>change buffer 用的是 buffer pool 里的内存，因此不能无限增大。change buffer 的大小，可以通过参数 innodb_change_buffer_max_size 来动态设置。这个参数设置为 50 的时候，表示 change buffer 的大小最多只能占用 buffer pool 的 50%。</li></ul><p>如果要在这张表中插入一个新记录 (4,400) 的话，InnoDB 的处理流程如下：</p><ol><li>这个记录要更新的目标页在内存中。InnoDB 的处理流程如下：</li></ol><ul><li>对于唯一索引来说，找到 3 和 5 之间的位置，判断到没有冲突，插入这个值，语句执行结束；</li><li>对于普通索引来说，找到 3 和 5 之间的位置，插入这个值，语句执行结束。</li></ul><ol start="2"><li>这个记录要更新的目标页不在内存中。InnoDB 的处理流程如下：</li></ol><ul><li>对于唯一索引来说，需要将数据页读入内存，判断到没有冲突，插入这个值，语句执行结束；</li><li>对于普通索引来说，则是将更新记录在 change buffer，语句执行就结束了。</li></ul><p><mark>唯一索引由于需要将数据从磁盘读取内存，导致其更新操作耗费巨大；而普通索引运用change buffer，减少了随机磁盘访问，提升更新性能。</mark></p><h2 id="change-buffer的使用场景" tabindex="-1">change buffer的使用场景 <a class="header-anchor" href="#change-buffer的使用场景" aria-label="Permalink to &quot;change buffer的使用场景&quot;">​</a></h2><p>change buffer 的主要目的就是将记录的变更动作缓存下来，所以在一个数据页做 merge 之前，change buffer 记录的变更越多（也就是这个页面上要更新的次数越多），收益就越大。</p><ul><li>因此，对于写多读少的业务来说，页面在写完以后马上被访问到的概率比较小，此时 change buffer 的使用效果最好。这种业务模型常见的就是<strong>账单类、日志类的系统</strong>。</li><li>而对于更新模式为写入之后马上会做查询的业务模式，随机访问 IO 的次数不会减少，<strong>反而增加了 change buffer 的维护代价</strong>，change buffer 反而起到了副作用。</li></ul><h2 id="索引选择和实践" tabindex="-1">索引选择和实践 <a class="header-anchor" href="#索引选择和实践" aria-label="Permalink to &quot;索引选择和实践&quot;">​</a></h2><ul><li>尽量选择普通索引，在实际使用中，普通索引和 change buffer 的配合使用，对于数据量大的表的更新优化还是很明显的</li><li>如果所有的更新后面，都马上伴随着对这个记录的查询，那么你应该关闭 change buffer。而在其他情况下，change buffer 都能提升更新性能。</li><li>特别地，在使用机械硬盘时，change buffer 这个机制的收效是非常显著的：把 change buffer 尽量开大，以确保这个“历史数据”表的数据写入速度。</li></ul><h2 id="change-buffer-和-redo-log" tabindex="-1">change buffer 和 redo log <a class="header-anchor" href="#change-buffer-和-redo-log" aria-label="Permalink to &quot;change buffer 和 redo log&quot;">​</a></h2><p>现执行插入语句，如下所示：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> insert into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t(id,k) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id1,k1),(id2,k2);</span></span></code></pre></div><p>假设当前 k 索引树的状态，查找到位置后，k1 所在的数据页在内存 (InnoDB buffer pool) 中，k2 所在的数据页不在内存中。带 change buffer 的更新状态图如下所示：</p><p><img src="/assets/2.CTIOzEqS.png" alt="image"></p><p>该操作涉及四个部分：内存、redo log（ib_log_fileX）、 数据表空间（t.ibd）、系统表空间（ibdata1）</p><p>这条更新语句做了如下的操作（按照图中的数字顺序）：</p><ol><li>Page 1 在内存中，直接更新内存；</li><li>Page 2 没有在内存中，就在内存的 change buffer 区域，记录下“我要往 Page 2 插入一行”这个信息；</li><li>将上述两个动作记入 redo log 中（图中 3 和 4）。</li></ol><p><strong>注</strong>：图中的两个虚线箭头，是后台操作，不影响更新的响应时间。</p><p>当在这个操作之后进行相应的读操作：select * from t where k in (k1, k2)。则带change buffer的读操作流程图如下所示：</p><p><img src="/assets/3.DzXbl3RA.png" alt="image"></p><ol><li>读 Page 1 的时候，直接从内存返回。</li><li>要读 Page 2 的时候，需要把 Page 2 从磁盘读入内存中，<strong>然后应用 change buffer 里面的操作日志，生成一个正确的版本并返回结果</strong>。</li></ol><p>因此，如果要简单地对比这两个机制在提升更新性能上的收益的话，<mark>redo log 主要节省的是随机写磁盘的 IO 消耗（转成顺序写），而 change buffer 主要节省的则是随机读磁盘的 IO 消耗。</mark></p></div></div></main><footer class="VPDocFooter" data-v-95d215ae data-v-19c972ee><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-19c972ee><span class="visually-hidden" id="doc-footer-aria-label" data-v-19c972ee>Pager</span><div class="pager" data-v-19c972ee><a class="VPLink link pager-link prev" href="/DATABASE/MySQL/chap07.html" data-v-19c972ee><!--[--><span class="desc" data-v-19c972ee>Previous page</span><span class="title" data-v-19c972ee>事务是否需要隔离</span><!--]--></a></div><div class="pager" data-v-19c972ee><a class="VPLink link pager-link next" href="/DATABASE/MySQL/chap09.html" data-v-19c972ee><!--[--><span class="desc" data-v-19c972ee>Next page</span><span class="title" data-v-19c972ee>MySQL为什么会选错索引？</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"database_mysql_chap06.md\":\"BbUIwKK1\",\"database_mysql_chap12.md\":\"M9_om4eA\",\"database_mysql_chap11.md\":\"B5SJAVry\",\"database_mysql_chap13.md\":\"Direv8j1\",\"database_mysql_chap01.md\":\"Ci1qcRa7\",\"database_mysql_chap18.md\":\"Dp9DnuJH\",\"database_mysql_chap00.md\":\"BM8HNyfJ\",\"intro.md\":\"CkJCjlR6\",\"database_mysql_chap02.md\":\"t5_m2sdP\",\"database_mysql_chap05.md\":\"BmfYVg8N\",\"database_mysql_chap08.md\":\"sjugScbW\",\"database_mysql_chap14.md\":\"vpLkgWJY\",\"database_mysql_chap09.md\":\"DTmlon-9\",\"java_基础_chapter13.md\":\"B5Mu2Hxf\",\"database_mysql_chap07.md\":\"CY0oFLGW\",\"database_mysql_chap10.md\":\"BYrjNhNU\",\"java_基础_chapter1.md\":\"BBo1m5R8\",\"database_mysql_chap17.md\":\"BDfbhkAb\",\"readme.md\":\"BbvCBKSX\",\"java_集合框架_collection_priorityqueue.md\":\"CFfvWL8S\",\"database_mysql_chap03.md\":\"BXtr4_5m\",\"java_基础_chapter2.md\":\"Deh0e1e_\",\"java_基础_chapter12.md\":\"BGVQjt7d\",\"database_mysql_chap16.md\":\"DZxrX8xf\",\"java_基础_chapter9.md\":\"BlWzp7p1\",\"index.md\":\"Bs8sgi3X\",\"java_集合框架_collection_arraydeque.md\":\"BYqqXK0m\",\"java_基础_chapter5.md\":\"CokY6fk0\",\"database_mysql_chap04.md\":\"RxuYHuCd\",\"springboot_chapter1.md\":\"DV65ecMJ\",\"java_基础_chapter7.md\":\"DqrtA3Hv\",\"database_mysql_chap15.md\":\"CdqqOT2H\",\"java_基础_chapter6.md\":\"D18DAQog\",\"java_基础_chapter11.md\":\"BMfuAG32\",\"java_基础_chapter10.md\":\"CgD2EtbK\",\"java_集合框架_collection-arraylist.md\":\"B9XfulVZ\",\"java_基础_chapter4.md\":\"B9AvAT9S\",\"java_集合框架_collection_linkedlist.md\":\"Dns1xqGf\",\"java_基础_chapter3.md\":\"CjIU5EpI\",\"java_基础_chapter14.md\":\"Div61QB6\",\"java_基础_chapter8.md\":\"VRf9RRMy\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"LWG Study\",\"description\":\"A VitePress Site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://gitee.com/gasj0ee/java_No1_knowledge/tree/master/\"}],\"nav\":[{\"text\":\"SpringBoot\",\"activeMatch\":\"/SpringBoot/\",\"link\":\"/SpringBoot/chapter1\"},{\"text\":\"DATABASE\",\"activeMatch\":\"/DATABASE/\",\"link\":\"/DATABASE/MySQL/chap00\"},{\"text\":\"JAVA\",\"activeMatch\":\"/JAVA/\",\"link\":\"/JAVA/基础/chapter1\"}],\"sidebar\":{\"/SpringBoot/\":[{\"text\":\"chapter1\",\"link\":\"/SpringBoot/chapter1\"}],\"/DATABASE/\":[{\"text\":\"MySQL\",\"collapsed\":false,\"items\":[{\"text\":\"MySQL 底层数据结构：B+树\",\"link\":\"/DATABASE/MySQL/chap00\"},{\"text\":\"MySQL基础架构\",\"link\":\"/DATABASE/MySQL/chap01\"},{\"text\":\"MySQL日志系统\",\"link\":\"/DATABASE/MySQL/chap02\"},{\"text\":\"事务隔离\",\"link\":\"/DATABASE/MySQL/chap03\"},{\"text\":\"索引\",\"link\":\"/DATABASE/MySQL/chap04\"},{\"text\":\"全局锁和表锁\",\"link\":\"/DATABASE/MySQL/chap05\"},{\"text\":\"行锁\",\"link\":\"/DATABASE/MySQL/chap06\"},{\"text\":\"事务是否需要隔离\",\"link\":\"/DATABASE/MySQL/chap07\"},{\"text\":\"普通索引和唯一索引\",\"link\":\"/DATABASE/MySQL/chap08\"},{\"text\":\"MySQL为什么会选错索引？\",\"link\":\"/DATABASE/MySQL/chap09\"},{\"text\":\"如何给字符串加索引？\",\"link\":\"/DATABASE/MySQL/chap10\"},{\"text\":\"为什么 MySQL 会“抖”一下\",\"link\":\"/DATABASE/MySQL/chap11\"},{\"text\":\"MySQL数据库表的空间回收\",\"link\":\"/DATABASE/MySQL/chap12\"},{\"text\":\"count(\\\\*)语句\",\"link\":\"/DATABASE/MySQL/chap13\"},{\"text\":\"日志和索引相关问题\",\"link\":\"/DATABASE/MySQL/chap14\"},{\"text\":\"order by 是如何工作的\",\"link\":\"/DATABASE/MySQL/chap15\"},{\"text\":\"如何正确显示随机消息\",\"link\":\"/DATABASE/MySQL/chap16\"},{\"text\":\"为什么 SQL 语句逻辑相同，但性能却差异巨大？\",\"link\":\"/DATABASE/MySQL/chap17\"},{\"text\":\"为什么查询一行的语句，执行也会很慢\",\"link\":\"/DATABASE/MySQL/chap18\"}]}],\"/JAVA/\":[{\"text\":\"集合框架\",\"collapsed\":false,\"items\":[{\"text\":\"ArrayList源码解析\",\"link\":\"/JAVA/集合框架/Collection-ArrayList\"},{\"text\":\"Stack & Queue (采用 ArrayDeque 实现)\",\"link\":\"/JAVA/集合框架/Collection_ArrayDeque\"},{\"text\":\"Collection - LinkedList 源码解析\",\"link\":\"/JAVA/集合框架/Collection_LinkedList\"},{\"text\":\"PriorityQueue 源码解析\",\"link\":\"/JAVA/集合框架/Collection_PriorityQueue\"}]},{\"text\":\"基础\",\"collapsed\":false,\"items\":[{\"text\":\"Java 简介\",\"link\":\"/JAVA/基础/chapter1\"},{\"text\":\"类、源文件、包、jar、模块、工程\",\"link\":\"/JAVA/基础/chapter10\"},{\"text\":\"反射\",\"link\":\"/JAVA/基础/chapter11\"},{\"text\":\"异常和断言\",\"link\":\"/JAVA/基础/chapter12\"},{\"text\":\"日志\",\"link\":\"/JAVA/基础/chapter13\"},{\"text\":\"集合\",\"link\":\"/JAVA/基础/chapter14\"},{\"text\":\"Java 基本程序设计结构\",\"link\":\"/JAVA/基础/chapter2\"},{\"text\":\"类\",\"link\":\"/JAVA/基础/chapter3\"},{\"text\":\"接口\",\"link\":\"/JAVA/基础/chapter4\"},{\"text\":\"lambda表达式\",\"link\":\"/JAVA/基础/chapter5\"},{\"text\":\"内部类\",\"link\":\"/JAVA/基础/chapter6\"},{\"text\":\"代理\",\"link\":\"/JAVA/基础/chapter7\"},{\"text\":\"泛型\",\"link\":\"/JAVA/基础/chapter8\"},{\"text\":\"关键字\",\"link\":\"/JAVA/基础/chapter9\"}]}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>